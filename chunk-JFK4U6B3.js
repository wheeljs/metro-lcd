import{a as ye}from"./chunk-R2BDAWXU.js";import{c as Te}from"./chunk-6YU6RO5A.js";import{$ as oe,$a as Oe,A as O,B as _,E as ne,F as ae,G as F,J as re,K as o,Ka as fe,L as d,La as k,O as se,P as b,Q as f,T as y,Ta as Ce,U as T,Ua as ve,V as j,W as R,Wa as be,X as c,Xa as xe,Y as h,Ya as Se,Z as M,Za as Ee,_a as we,a as B,aa as A,ab as _e,b as S,ba as u,c as U,cb as Me,db as Le,e as E,eb as Ie,f as Z,fa as ce,fb as ze,g as $,ga as p,gb as De,ha as he,i as H,ia as le,ja as de,k as q,ka as ue,kb as Fe,l as W,la as pe,m as w,ma as me,n as X,p as J,q as m,r as K,s as D,t as Q,u as Y,v as g,w as ee,y as te,z as ie,za as ge}from"./chunk-SD72LGQS.js";import{a as v,b as z,e as x}from"./chunk-2H7K6JAD.js";var P=class{constructor(){this.subject=new E(1),this.subscriptions=new B}doFilter(t){this.subject.next(t)}dispose(){this.subscriptions.unsubscribe()}notEmpty(t,a){this.subscriptions.add(this.subject.subscribe(e=>{if(e[t]){let i=e[t].currentValue;i!=null&&a(i)}}))}has(t,a){this.subscriptions.add(this.subject.subscribe(e=>{if(e[t]){let i=e[t].currentValue;a(i)}}))}notFirst(t,a){this.subscriptions.add(this.subject.subscribe(e=>{if(e[t]&&!e[t].isFirstChange()){let i=e[t].currentValue;a(i)}}))}notFirstAndEmpty(t,a){this.subscriptions.add(this.subject.subscribe(e=>{if(e[t]&&!e[t].isFirstChange()){let i=e[t].currentValue;i!=null&&a(i)}}))}},je=new K("NGX_ECHARTS_CONFIG"),Re=(()=>{let t=class t{constructor(e,i,r){this.el=i,this.ngZone=r,this.options=null,this.theme=null,this.initOpts=null,this.merge=null,this.autoResize=!0,this.loading=!1,this.loadingType="default",this.loadingOpts=null,this.chartInit=new F,this.optionsError=new F,this.chartClick=this.createLazyEvent("click"),this.chartDblClick=this.createLazyEvent("dblclick"),this.chartMouseDown=this.createLazyEvent("mousedown"),this.chartMouseMove=this.createLazyEvent("mousemove"),this.chartMouseUp=this.createLazyEvent("mouseup"),this.chartMouseOver=this.createLazyEvent("mouseover"),this.chartMouseOut=this.createLazyEvent("mouseout"),this.chartGlobalOut=this.createLazyEvent("globalout"),this.chartContextMenu=this.createLazyEvent("contextmenu"),this.chartHighlight=this.createLazyEvent("highlight"),this.chartDownplay=this.createLazyEvent("downplay"),this.chartSelectChanged=this.createLazyEvent("selectchanged"),this.chartLegendSelectChanged=this.createLazyEvent("legendselectchanged"),this.chartLegendSelected=this.createLazyEvent("legendselected"),this.chartLegendUnselected=this.createLazyEvent("legendunselected"),this.chartLegendLegendSelectAll=this.createLazyEvent("legendselectall"),this.chartLegendLegendInverseSelect=this.createLazyEvent("legendinverseselect"),this.chartLegendScroll=this.createLazyEvent("legendscroll"),this.chartDataZoom=this.createLazyEvent("datazoom"),this.chartDataRangeSelected=this.createLazyEvent("datarangeselected"),this.chartGraphRoam=this.createLazyEvent("graphroam"),this.chartGeoRoam=this.createLazyEvent("georoam"),this.chartTreeRoam=this.createLazyEvent("treeroam"),this.chartTimelineChanged=this.createLazyEvent("timelinechanged"),this.chartTimelinePlayChanged=this.createLazyEvent("timelineplaychanged"),this.chartRestore=this.createLazyEvent("restore"),this.chartDataViewChanged=this.createLazyEvent("dataviewchanged"),this.chartMagicTypeChanged=this.createLazyEvent("magictypechanged"),this.chartGeoSelectChanged=this.createLazyEvent("geoselectchanged"),this.chartGeoSelected=this.createLazyEvent("geoselected"),this.chartGeoUnselected=this.createLazyEvent("geounselected"),this.chartAxisAreaSelected=this.createLazyEvent("axisareaselected"),this.chartBrush=this.createLazyEvent("brush"),this.chartBrushEnd=this.createLazyEvent("brushend"),this.chartBrushSelected=this.createLazyEvent("brushselected"),this.chartGlobalCursorTaken=this.createLazyEvent("globalcursortaken"),this.chartRendered=this.createLazyEvent("rendered"),this.chartFinished=this.createLazyEvent("finished"),this.animationFrameID=null,this.chart$=new E(1),this.resize$=new U,this.changeFilter=new P,this.echarts=e.echarts}ngOnChanges(e){this.changeFilter.doFilter(e)}ngOnInit(){if(!window.ResizeObserver)throw new Error("please install a polyfill for ResizeObserver");this.resizeSub=this.resize$.pipe(X(100,Z,{leading:!1,trailing:!0})).subscribe(()=>this.resize()),this.autoResize&&(this.resizeOb=this.ngZone.runOutsideAngular(()=>new window.ResizeObserver(()=>{this.animationFrameID=window.requestAnimationFrame(()=>this.resize$.next())})),this.resizeOb.observe(this.el.nativeElement)),this.changeFilter.notFirstAndEmpty("options",e=>this.onOptionsChange(e)),this.changeFilter.notFirstAndEmpty("merge",e=>this.setOption(e)),this.changeFilter.has("loading",e=>this.toggleLoading(!!e)),this.changeFilter.notFirst("theme",()=>this.refreshChart())}ngOnDestroy(){window.clearTimeout(this.initChartTimer),this.resizeSub&&this.resizeSub.unsubscribe(),this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeOb&&this.resizeOb.unobserve(this.el.nativeElement),this.loadingSub&&this.loadingSub.unsubscribe(),this.changeFilter.dispose(),this.dispose()}ngAfterViewInit(){this.initChartTimer=window.setTimeout(()=>this.initChart())}dispose(){this.chart&&(this.chart.isDisposed()||this.chart.dispose(),this.chart=null)}resize(){this.chart&&this.chart.resize()}toggleLoading(e){this.chart?e?this.chart.showLoading(this.loadingType,this.loadingOpts):this.chart.hideLoading():this.loadingSub=this.chart$.subscribe(i=>e?i.showLoading(this.loadingType,this.loadingOpts):i.hideLoading())}setOption(e,i){if(this.chart)try{this.chart.setOption(e,i)}catch(r){console.error(r),this.optionsError.emit(r)}}refreshChart(){return x(this,null,function*(){this.dispose(),yield this.initChart()})}createChart(){let e=this.el.nativeElement;if(window&&window.getComputedStyle){let i=window.getComputedStyle(e,null).getPropertyValue("height");(!i||i==="0px")&&(!e.style.height||e.style.height==="0px")&&(e.style.height="400px")}return this.ngZone.runOutsideAngular(()=>(typeof this.echarts=="function"?this.echarts:()=>Promise.resolve(this.echarts))().then(({init:r})=>r(e,this.theme,this.initOpts)))}initChart(){return x(this,null,function*(){yield this.onOptionsChange(this.options),this.merge&&this.chart&&this.setOption(this.merge)})}onOptionsChange(e){return x(this,null,function*(){e&&(this.chart?this.setOption(this.options,!0):(this.chart=yield this.createChart(),this.chart$.next(this.chart),this.chartInit.emit(this.chart),this.setOption(this.options,!0)))})}createLazyEvent(e){return this.chartInit.pipe(q(i=>new S(r=>(i.on(e,s=>this.ngZone.run(()=>r.next(s))),()=>{this.chart&&(this.chart.isDisposed()||i.off(e))}))))}};t.\u0275fac=function(i){return new(i||t)(d(je),d(ae),d(se))},t.\u0275dir=ee({type:t,selectors:[["echarts"],["","echarts",""]],inputs:{options:"options",theme:"theme",initOpts:"initOpts",merge:"merge",autoResize:"autoResize",loading:"loading",loadingType:"loadingType",loadingOpts:"loadingOpts"},outputs:{chartInit:"chartInit",optionsError:"optionsError",chartClick:"chartClick",chartDblClick:"chartDblClick",chartMouseDown:"chartMouseDown",chartMouseMove:"chartMouseMove",chartMouseUp:"chartMouseUp",chartMouseOver:"chartMouseOver",chartMouseOut:"chartMouseOut",chartGlobalOut:"chartGlobalOut",chartContextMenu:"chartContextMenu",chartHighlight:"chartHighlight",chartDownplay:"chartDownplay",chartSelectChanged:"chartSelectChanged",chartLegendSelectChanged:"chartLegendSelectChanged",chartLegendSelected:"chartLegendSelected",chartLegendUnselected:"chartLegendUnselected",chartLegendLegendSelectAll:"chartLegendLegendSelectAll",chartLegendLegendInverseSelect:"chartLegendLegendInverseSelect",chartLegendScroll:"chartLegendScroll",chartDataZoom:"chartDataZoom",chartDataRangeSelected:"chartDataRangeSelected",chartGraphRoam:"chartGraphRoam",chartGeoRoam:"chartGeoRoam",chartTreeRoam:"chartTreeRoam",chartTimelineChanged:"chartTimelineChanged",chartTimelinePlayChanged:"chartTimelinePlayChanged",chartRestore:"chartRestore",chartDataViewChanged:"chartDataViewChanged",chartMagicTypeChanged:"chartMagicTypeChanged",chartGeoSelectChanged:"chartGeoSelectChanged",chartGeoSelected:"chartGeoSelected",chartGeoUnselected:"chartGeoUnselected",chartAxisAreaSelected:"chartAxisAreaSelected",chartBrush:"chartBrush",chartBrushEnd:"chartBrushEnd",chartBrushSelected:"chartBrushSelected",chartGlobalCursorTaken:"chartGlobalCursorTaken",chartRendered:"chartRendered",chartFinished:"chartFinished"},exportAs:["echarts"],standalone:!0,features:[ie]});let n=t;return n})();var Ge=n=>({provide:je,useValue:n}),Ae=(()=>{let t=class t{static forRoot(e){return{ngModule:t,providers:[Ge(e)]}}static forChild(){return{ngModule:t}}};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=g({type:t}),t.\u0275inj=m({});let n=t;return n})();function G(n){n||(te(G),n=Q(ne));let t=new S(a=>n.onDestroy(a.next.bind(a)));return a=>a.pipe(W(t))}var C=class{};function Be(n,t){n&1&&(c(0,"div",1),M(1,"mat-spinner"),h())}function Ue(n,t){if(n&1&&(c(0,"mat-option",4),p(1),h()),n&2){let a=t.$implicit;f("value",a),o(),le(" ",a," ")}}function Ze(n,t){if(n&1&&(c(0,"a",10),p(1,"\u9605\u8BFB\u539F\u6587"),h()),n&2){let a=u(3);f("href",a.data.originLink,re)}}function $e(n,t){if(n&1&&(c(0,"li"),p(1),h()),n&2){let a=t.$implicit;o(),he(a)}}function He(n,t){if(n&1&&(c(0,"section",12)(1,"ul"),j(2,$e,2,1,"li",null,T),h()()),n&2){let a=u(3);o(2),R(a.data.summaries)}}function qe(n,t){if(n&1&&(c(0,"main")(1,"div",8)(2,"h1"),p(3),h(),c(4,"div",9),b(5,Ze,2,1,"a",10),h()(),M(6,"div",11),b(7,He,4,0,"section",12),h()),n&2){let a=u(2);o(3),de("",a.data.year,"\u5E74",a.data.month,"\u6708\u57CE\u5E02\u8F68\u9053\u4EA4\u901A\u8FD0\u8425\u6570\u636E"),o(2),y(5,a.data.originLink?5:-1),o(),f("options",a.options),o(),y(7,a.data.summaries?7:-1)}}function We(n,t){if(n&1){let a=oe();c(0,"mat-sidenav-container")(1,"mat-sidenav",2,0),me("openedChange",function(i){O(a);let r=u();return pe(r.opened,i)||(r.opened=i),_(i)}),c(3,"mat-card")(4,"mat-card-header")(5,"mat-card-title"),p(6,"\u8BBE\u7F6E"),h()(),c(7,"mat-card-content")(8,"mat-form-field")(9,"mat-label"),p(10,"\u6570\u636E\u8303\u56F4"),h(),c(11,"mat-select",3),A("valueChange",function(i){O(a);let r=u();return _(r.onRangeChange(i))}),j(12,Ue,2,2,"mat-option",4,T),h()()()()(),c(14,"mat-sidenav-content")(15,"div",5),A("click",function(){O(a);let i=ce(2);return _(i.toggle())}),c(16,"button",6),M(17,"fa-icon",7),h()(),b(18,qe,8,5,"main"),h()()}if(n&2){let a=u();o(),ue("opened",a.opened),o(10),f("value",a.selectedId),o(),R(a.ids),o(5),f("icon",a.faSliders),o(),y(18,a.data?18:-1)}}var Xe=(n,t)=>Number.parseFloat((n/t).toFixed(2)),Je={passengerCapacity:{unit:1e4,suffix:"\u4E07\u4EBA\u6B21"},inStationCapacity:{unit:1e4,suffix:"\u4E07\u4EBA\u6B21"},passengerStrong:{suffix:"\u4E07\u4EBA\u6B21\u6BCF\u516C\u91CC\u65E5"}},N=(()=>{let t=class t{set range(e){this.selectedId=e,this.ids.length&&this.rangeUpdate(e)}get ids(){return Object.keys(this.list)}get data(){return this._data}set data(e){this.selectedId=e.id,this._data=e}constructor(e,i){this.router=e,this.dataService=i,this.faSliders=Te,this.list={},this.loading=!0,this.options={grid:{right:100,left:100},legend:{right:100},tooltip:{trigger:"axis"},dataset:[{source:[],dimensions:[{name:"city",displayName:"\u57CE\u5E02"},{name:"passengerCapacity",displayName:"\u5BA2\u8FD0\u91CF"},{name:"inStationCapacity",displayName:"\u8FDB\u7AD9\u91CF"},{name:"passengerStrong",displayName:"\u5BA2\u6D41\u5F3A\u5EA6"}]}],xAxis:{type:"category",axisLabel:{formatter:r=>{if(r.length<=2)return r;let s=[];for(let l=0;l<r.length;l+=2)s.push(r.slice(l,l+2));return s.join(`
`)}},axisTick:{show:!1}},yAxis:[{name:"\u4E07\u4EBA\u6B21",nameTextStyle:{align:"right"}},{name:"\u4E07\u4EBA\u6B21\u6BCF\u516C\u91CC\u65E5",nameTextStyle:{align:"right"},alignTicks:!0,splitLine:{show:!1}}],series:[{type:"bar",encode:{seriesName:"passengerCapacity",y:"passengerCapacity"}},{type:"bar",encode:{seriesName:"inStationCapacity",y:"inStationCapacity"}},{type:"bar",yAxisIndex:1,encode:{seriesName:"passengerStrong",y:"passengerStrong"}}],dataZoom:[{type:"slider",startValue:0,endValue:12,maxValueSpan:Number.MAX_SAFE_INTEGER,brushSelect:!1,bottom:0}]},this.opened=!1,this.dataService.list().pipe(w(()=>this.loading=!0),H(()=>Object.keys(this.list).length===0),G()).subscribe({next:r=>{let s={};r.forEach(l=>{s[l.id]=l}),this.list=s,this.onRangeChange(this.selectedId||r[0].id)}})}unboxArrayOrObject(e){return Array.isArray(e)?e[0]:e}updateData({data:e,error:i}){if(e){let r=v({},e);r.cities=e.cities.map(s=>{let l=v({},s);return Object.entries(Je).forEach(([I,V])=>{V.unit&&typeof s[I]=="number"&&(l[I]=Xe(s[I],V.unit))}),l}),this.options=z(v({},this.options),{dataset:[z(v({},this.unboxArrayOrObject(this.options.dataset)),{source:r.cities})]}),this.data=r}}onRangeChange(e){this.loading=!0;let i=this.list[e];this.dataService.getData({range:e,hash:i.hash}).subscribe({next:r=>{this.list=Object.assign({},this.list,{[e]:r}),this.selectedId!==e&&this.router.navigateByUrl(`/dashboard/${e}`),this.rangeUpdate(e)}})}rangeUpdate(e){this.updateData({data:this.list[e]}),this.loading=!1}};t.\u0275fac=function(i){return new(i||t)(d(fe),d(C))},t.\u0275cmp=Y({type:t,selectors:[["md-index"]],inputs:{range:"range"},decls:2,vars:2,consts:[["sidenav",""],[1,"loading"],["mode","over","position","end",3,"openedChange","opened"],[3,"valueChange","value"],[3,"value"],[1,"sidenav-toggle",3,"click"],["mat-mini-fab","","color","#cccccc"],[3,"icon"],[1,"title"],[1,"subtitle"],["target","_blank","referrerpolicy","no-referrer",1,"read-origin",3,"href"],["echarts","",3,"options"],[1,"summaries"]],template:function(i,r){i&1&&b(0,Be,2,0,"div",1)(1,We,19,4,"mat-sidenav-container"),i&2&&(y(0,r.loading?0:-1),o(),y(1,r.list?1:-1))},dependencies:[Ce,be,xe,Ee,we,Se,_e,Oe,Me,Le,ve,ze,De,Ie,Re],styles:["[_nghost-%COMP%]{position:relative;display:block;height:100vh}.mat-sidenav-container[_ngcontent-%COMP%]{height:100%}.sidenav-toggle[_ngcontent-%COMP%]{position:absolute;right:10px;top:20px}.loading[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background-color:#fff;z-index:10}.title[_ngcontent-%COMP%]{text-align:center}.title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:24px 0 16px}.title[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin-right:100px;text-align:right}.title[_ngcontent-%COMP%]   .read-origin[_ngcontent-%COMP%]{font-size:12px;text-decoration:none}.title[_ngcontent-%COMP%]   .read-origin[_ngcontent-%COMP%]:active, .title[_ngcontent-%COMP%]   .read-origin[_ngcontent-%COMP%]:visited{color:#ccc}.title[_ngcontent-%COMP%]   .read-origin[_ngcontent-%COMP%]:hover{text-decoration:underline}[echarts][_ngcontent-%COMP%]{height:600px}.summaries[_ngcontent-%COMP%]{font-size:12px;line-height:1.33334;color:#333}.summaries[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:100px;list-style:none}"]});let n=t;return n})();var Ke=[{path:":range",component:N},{path:"",component:N}],ke=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=g({type:t}),t.\u0275inj=m({imports:[k.forChild(Ke),k]});let n=t;return n})();var Pe=(()=>{let t=class t{constructor(e,i){this.storage=e,this.httpClient=i}list(){return this.httpClient.get("assets/dashboard-manifest.json")}getData({range:e,hash:i,skipCache:r}){if(!r&&e in this.storage){let s=JSON.parse(this.storage[e]);if(s.hash===i)return $(s.data);this.storage.removeItem(e)}return this.httpClient.get(`assets/dashboard-data/${e}.json`).pipe(w(s=>{this.storage[e]=JSON.stringify({hash:i,data:s})}))}};t.\u0275fac=function(i){return new(i||t)(D(ye),D(ge))},t.\u0275prov=J({token:t,factory:t.\u0275fac});let n=t;return n})();var qt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=g({type:t}),t.\u0275inj=m({providers:[{provide:C,useClass:Pe}],imports:[Fe,ke,Ae.forRoot({echarts:()=>import("./chunk-ZVO7MRV4.js")})]});let n=t;return n})();export{qt as DashboardModule};
