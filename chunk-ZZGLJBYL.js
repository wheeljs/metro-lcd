import{c as Ve}from"./chunk-VSQXB3HK.js";import{$a as Me,A as oe,B as _,C as M,F as ce,G as he,H as F,K as le,Ka as be,L as s,La as k,M as m,Ma as P,P as de,Q as E,R as C,U as v,Ua as xe,V as T,Va as Ee,W as R,X as j,Xa as Se,Y as o,Ya as we,Z as c,Za as Oe,_ as L,_a as _e,a as $,aa as ue,ab as Le,b as w,ba as A,bb as ze,c as Z,ca as p,db as Ie,e as O,eb as De,f as q,fb as Fe,g as H,ga as me,gb as Te,h as D,ha as g,hb as Re,i as W,ia as pe,j as X,ja as ge,jb as je,ka as fe,kb as Ae,l as J,la as ye,lb as ke,m as K,ma as Ce,mb as Pe,n as Q,na as ve,nb as Ge,o as Y,ob as G,pb as N,q as ee,r as f,s as te,sb as Ne,t as ie,u as ne,v as re,w as y,x as ae,z as se}from"./chunk-WZBIZ7K5.js";import{a as u,b as I,e as S}from"./chunk-2H7K6JAD.js";var V=class{constructor(){this.subject=new O(1),this.subscriptions=new $}doFilter(e){this.subject.next(e)}dispose(){this.subscriptions.unsubscribe()}notEmpty(e,r){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]){let i=t[e].currentValue;i!=null&&r(i)}}))}has(e,r){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]){let i=t[e].currentValue;r(i)}}))}notFirst(e,r){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]&&!t[e].isFirstChange()){let i=t[e].currentValue;r(i)}}))}notFirstAndEmpty(e,r){this.subscriptions.add(this.subject.subscribe(t=>{if(t[e]&&!t[e].isFirstChange()){let i=t[e].currentValue;i!=null&&r(i)}}))}},Be=new te("NGX_ECHARTS_CONFIG"),Ue=(()=>{let e=class e{constructor(t,i,a){this.el=i,this.ngZone=a,this.options=null,this.theme=null,this.initOpts=null,this.merge=null,this.autoResize=!0,this.loading=!1,this.loadingType="default",this.loadingOpts=null,this.chartInit=new F,this.optionsError=new F,this.chartClick=this.createLazyEvent("click"),this.chartDblClick=this.createLazyEvent("dblclick"),this.chartMouseDown=this.createLazyEvent("mousedown"),this.chartMouseMove=this.createLazyEvent("mousemove"),this.chartMouseUp=this.createLazyEvent("mouseup"),this.chartMouseOver=this.createLazyEvent("mouseover"),this.chartMouseOut=this.createLazyEvent("mouseout"),this.chartGlobalOut=this.createLazyEvent("globalout"),this.chartContextMenu=this.createLazyEvent("contextmenu"),this.chartHighlight=this.createLazyEvent("highlight"),this.chartDownplay=this.createLazyEvent("downplay"),this.chartSelectChanged=this.createLazyEvent("selectchanged"),this.chartLegendSelectChanged=this.createLazyEvent("legendselectchanged"),this.chartLegendSelected=this.createLazyEvent("legendselected"),this.chartLegendUnselected=this.createLazyEvent("legendunselected"),this.chartLegendLegendSelectAll=this.createLazyEvent("legendselectall"),this.chartLegendLegendInverseSelect=this.createLazyEvent("legendinverseselect"),this.chartLegendScroll=this.createLazyEvent("legendscroll"),this.chartDataZoom=this.createLazyEvent("datazoom"),this.chartDataRangeSelected=this.createLazyEvent("datarangeselected"),this.chartGraphRoam=this.createLazyEvent("graphroam"),this.chartGeoRoam=this.createLazyEvent("georoam"),this.chartTreeRoam=this.createLazyEvent("treeroam"),this.chartTimelineChanged=this.createLazyEvent("timelinechanged"),this.chartTimelinePlayChanged=this.createLazyEvent("timelineplaychanged"),this.chartRestore=this.createLazyEvent("restore"),this.chartDataViewChanged=this.createLazyEvent("dataviewchanged"),this.chartMagicTypeChanged=this.createLazyEvent("magictypechanged"),this.chartGeoSelectChanged=this.createLazyEvent("geoselectchanged"),this.chartGeoSelected=this.createLazyEvent("geoselected"),this.chartGeoUnselected=this.createLazyEvent("geounselected"),this.chartAxisAreaSelected=this.createLazyEvent("axisareaselected"),this.chartBrush=this.createLazyEvent("brush"),this.chartBrushEnd=this.createLazyEvent("brushend"),this.chartBrushSelected=this.createLazyEvent("brushselected"),this.chartGlobalCursorTaken=this.createLazyEvent("globalcursortaken"),this.chartRendered=this.createLazyEvent("rendered"),this.chartFinished=this.createLazyEvent("finished"),this.animationFrameID=null,this.chart$=new O(1),this.resize$=new Z,this.changeFilter=new V,this.echarts=t.echarts}ngOnChanges(t){this.changeFilter.doFilter(t)}ngOnInit(){if(!window.ResizeObserver)throw new Error("please install a polyfill for ResizeObserver");this.resizeSub=this.resize$.pipe(Y(100,q,{leading:!1,trailing:!0})).subscribe(()=>this.resize()),this.autoResize&&(this.resizeOb=this.ngZone.runOutsideAngular(()=>new window.ResizeObserver(()=>{this.animationFrameID=window.requestAnimationFrame(()=>this.resize$.next())})),this.resizeOb.observe(this.el.nativeElement)),this.changeFilter.notFirstAndEmpty("options",t=>this.onOptionsChange(t)),this.changeFilter.notFirstAndEmpty("merge",t=>this.setOption(t)),this.changeFilter.has("loading",t=>this.toggleLoading(!!t)),this.changeFilter.notFirst("theme",()=>this.refreshChart())}ngOnDestroy(){window.clearTimeout(this.initChartTimer),this.resizeSub&&this.resizeSub.unsubscribe(),this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeOb&&this.resizeOb.unobserve(this.el.nativeElement),this.loadingSub&&this.loadingSub.unsubscribe(),this.changeFilter.dispose(),this.dispose()}ngAfterViewInit(){this.initChartTimer=window.setTimeout(()=>this.initChart())}dispose(){this.chart&&(this.chart.isDisposed()||this.chart.dispose(),this.chart=null)}resize(){this.chart&&this.chart.resize()}toggleLoading(t){this.chart?t?this.chart.showLoading(this.loadingType,this.loadingOpts):this.chart.hideLoading():this.loadingSub=this.chart$.subscribe(i=>t?i.showLoading(this.loadingType,this.loadingOpts):i.hideLoading())}setOption(t,i){if(this.chart)try{this.chart.setOption(t,i)}catch(a){console.error(a),this.optionsError.emit(a)}}refreshChart(){return S(this,null,function*(){this.dispose(),yield this.initChart()})}createChart(){let t=this.el.nativeElement;if(window&&window.getComputedStyle){let i=window.getComputedStyle(t,null).getPropertyValue("height");(!i||i==="0px")&&(!t.style.height||t.style.height==="0px")&&(t.style.height="400px")}return this.ngZone.runOutsideAngular(()=>(typeof this.echarts=="function"?this.echarts:()=>Promise.resolve(this.echarts))().then(({init:a})=>a(t,this.theme,this.initOpts)))}initChart(){return S(this,null,function*(){yield this.onOptionsChange(this.options),this.merge&&this.chart&&this.setOption(this.merge)})}onOptionsChange(t){return S(this,null,function*(){t&&(this.chart?this.setOption(this.options,!0):(this.chart=yield this.createChart(),this.chart$.next(this.chart),this.chartInit.emit(this.chart),this.setOption(this.options,!0)))})}createLazyEvent(t){return this.chartInit.pipe(J(i=>new w(a=>(i.on(t,h=>this.ngZone.run(()=>a.next(h))),()=>{this.chart&&(this.chart.isDisposed()||i.off(t))}))))}};e.\u0275fac=function(i){return new(i||e)(m(Be),m(he),m(de))},e.\u0275dir=ae({type:e,selectors:[["echarts"],["","echarts",""]],inputs:{options:"options",theme:"theme",initOpts:"initOpts",merge:"merge",autoResize:"autoResize",loading:"loading",loadingType:"loadingType",loadingOpts:"loadingOpts"},outputs:{chartInit:"chartInit",optionsError:"optionsError",chartClick:"chartClick",chartDblClick:"chartDblClick",chartMouseDown:"chartMouseDown",chartMouseMove:"chartMouseMove",chartMouseUp:"chartMouseUp",chartMouseOver:"chartMouseOver",chartMouseOut:"chartMouseOut",chartGlobalOut:"chartGlobalOut",chartContextMenu:"chartContextMenu",chartHighlight:"chartHighlight",chartDownplay:"chartDownplay",chartSelectChanged:"chartSelectChanged",chartLegendSelectChanged:"chartLegendSelectChanged",chartLegendSelected:"chartLegendSelected",chartLegendUnselected:"chartLegendUnselected",chartLegendLegendSelectAll:"chartLegendLegendSelectAll",chartLegendLegendInverseSelect:"chartLegendLegendInverseSelect",chartLegendScroll:"chartLegendScroll",chartDataZoom:"chartDataZoom",chartDataRangeSelected:"chartDataRangeSelected",chartGraphRoam:"chartGraphRoam",chartGeoRoam:"chartGeoRoam",chartTreeRoam:"chartTreeRoam",chartTimelineChanged:"chartTimelineChanged",chartTimelinePlayChanged:"chartTimelinePlayChanged",chartRestore:"chartRestore",chartDataViewChanged:"chartDataViewChanged",chartMagicTypeChanged:"chartMagicTypeChanged",chartGeoSelectChanged:"chartGeoSelectChanged",chartGeoSelected:"chartGeoSelected",chartGeoUnselected:"chartGeoUnselected",chartAxisAreaSelected:"chartAxisAreaSelected",chartBrush:"chartBrush",chartBrushEnd:"chartBrushEnd",chartBrushSelected:"chartBrushSelected",chartGlobalCursorTaken:"chartGlobalCursorTaken",chartRendered:"chartRendered",chartFinished:"chartFinished"},exportAs:["echarts"],standalone:!0,features:[oe]});let n=e;return n})();var He=n=>({provide:Be,useValue:n}),$e=(()=>{let e=class e{static forRoot(t){return{ngModule:e,providers:[He(t)]}}static forChild(){return{ngModule:e}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=y({type:e}),e.\u0275inj=f({});let n=e;return n})();function B(n){n||(se(B),n=ne(ce));let e=new w(r=>n.onDestroy(r.next.bind(r)));return r=>r.pipe(K(e))}var b=class{};function Je(n,e){n&1&&(o(0,"div",1),L(1,"mat-spinner"),c())}function Ke(n,e){if(n&1&&(o(0,"mat-option",4),g(1),c()),n&2){let r=e.$implicit;C("value",r),s(),ge(" ",r," ")}}function Qe(n,e){if(n&1&&(o(0,"a",10),g(1,"\u9605\u8BFB\u539F\u6587"),c()),n&2){let r=p(3);C("href",r.data.originLink,le)}}function Ye(n,e){if(n&1&&(o(0,"li"),g(1),c()),n&2){let r=e.$implicit;s(),pe(r)}}function et(n,e){if(n&1&&(o(0,"section",12)(1,"ul"),R(2,Ye,2,1,"li",null,T),c()()),n&2){let r=p(3);s(2),j(r.data.summaries)}}function tt(n,e){if(n&1&&(o(0,"main")(1,"div",8)(2,"h1"),g(3),c(),o(4,"div",9),E(5,Qe,2,1,"a",10),c()(),L(6,"div",11),E(7,et,4,0,"section",12),c()),n&2){let r=p(2);s(3),fe("\u4EA4\u901A\u8FD0\u8F93\u90E8",r.data.year,"\u5E74",r.data.month,"\u6708\u57CE\u5E02\u8F68\u9053\u4EA4\u901A\u8FD0\u8425\u6570\u636E"),s(2),v(5,r.data.originLink?5:-1),s(),C("options",r.options),s(),v(7,r.data.summaries?7:-1)}}function it(n,e){if(n&1){let r=ue();o(0,"mat-sidenav-container")(1,"mat-sidenav",2,0),ve("openedChange",function(i){_(r);let a=p();return Ce(a.opened,i)||(a.opened=i),M(i)}),o(3,"mat-card")(4,"mat-card-header")(5,"mat-card-title"),g(6,"\u8BBE\u7F6E"),c()(),o(7,"mat-card-content")(8,"mat-form-field")(9,"mat-label"),g(10,"\u6570\u636E\u8303\u56F4"),c(),o(11,"mat-select",3),A("valueChange",function(i){_(r);let a=p();return M(a.onRangeChange(i))}),R(12,Ke,2,2,"mat-option",4,T),c()()()()(),o(14,"mat-sidenav-content")(15,"div",5),A("click",function(){_(r);let i=me(2);return M(i.toggle())}),o(16,"button",6),L(17,"fa-icon",7),c()(),E(18,tt,8,5,"main"),c()()}if(n&2){let r=p();s(),ye("opened",r.opened),s(10),C("value",r.selectedId),s(),j(r.ids),s(5),C("icon",r.faSliders),s(),v(18,r.data?18:-1)}}var nt=(n,e)=>Number.parseFloat((n/e).toFixed(2)),rt={passengerCapacity:{unit:1e4,suffix:"\u4E07\u4EBA\u6B21"},inStationCapacity:{unit:1e4,suffix:"\u4E07\u4EBA\u6B21"},passengerStrong:{suffix:"\u4E07\u4EBA\u6B21\u6BCF\u516C\u91CC\u65E5"}},U=(()=>{let e=class e{set range(t){this.selectedId=t,this.ids.length&&this.rangeUpdate(t)}get ids(){return Object.keys(this.list)}get data(){return this._data}set data(t){this.selectedId=t.id,this._data=t}constructor(t,i){this.router=t,this.dataService=i,this.faSliders=Ve,this.list={},this.loading=!0,this.options={grid:{right:100,left:100},legend:{right:100},tooltip:{trigger:"axis"},dataset:[{source:[],dimensions:[{name:"city",displayName:"\u57CE\u5E02"},{name:"passengerCapacity",displayName:"\u5BA2\u8FD0\u91CF"},{name:"inStationCapacity",displayName:"\u8FDB\u7AD9\u91CF"},{name:"passengerStrong",displayName:"\u5BA2\u6D41\u5F3A\u5EA6"}]}],xAxis:{type:"category",axisLabel:{formatter:a=>{if(a.length<=2)return a;let h=[];for(let l=0;l<a.length;l+=2)h.push(a.slice(l,l+2));return h.join(`
`)}},axisTick:{show:!1}},yAxis:[{name:"\u4E07\u4EBA\u6B21",nameTextStyle:{align:"right"}},{name:"\u4E07\u4EBA\u6B21\u6BCF\u516C\u91CC\u65E5",nameTextStyle:{align:"right"},alignTicks:!0,splitLine:{show:!1}}],series:[{type:"bar",encode:{seriesName:"passengerCapacity",y:"passengerCapacity"}},{type:"bar",encode:{seriesName:"inStationCapacity",y:"inStationCapacity"}},{type:"bar",yAxisIndex:1,encode:{seriesName:"passengerStrong",y:"passengerStrong"}}],dataZoom:[{type:"slider",startValue:0,endValue:12,maxValueSpan:Number.MAX_SAFE_INTEGER,brushSelect:!1,bottom:0}]},this.opened=!1,this.dataService.list().pipe(Q(()=>this.loading=!0),X(()=>Object.keys(this.list).length===0),B()).subscribe({next:a=>{let h={};a.forEach(l=>{h[l.id]=l}),this.list=h,this.selectedId?this.rangeUpdate(this.selectedId):this.onRangeChange(a[0].id)}})}unboxArrayOrObject(t){return Array.isArray(t)?t[0]:t}updateData({data:t,error:i}){if(t){let a=u({},t);a.cities=t.cities.map(h=>{let l=u({},h);return Object.entries(rt).forEach(([x,d])=>{d.unit&&typeof h[x]=="number"&&(l[x]=nt(h[x],d.unit))}),l}),this.options=I(u({},this.options),{dataset:[I(u({},this.unboxArrayOrObject(this.options.dataset)),{source:a.cities})]}),this.data=a}}onRangeChange(t){this.loading=!0,this.router.navigateByUrl(`/dashboard/${t}`)}rangeUpdate(t){this.updateData({data:this.list[t]}),this.loading=!1}};e.\u0275fac=function(i){return new(i||e)(m(be),m(b))},e.\u0275cmp=re({type:e,selectors:[["md-index"]],inputs:{range:"range"},decls:2,vars:2,consts:[["sidenav",""],[1,"loading"],["mode","over","position","end",3,"openedChange","opened"],[3,"valueChange","value"],[3,"value"],[1,"sidenav-toggle",3,"click"],["mat-mini-fab","","color","#cccccc"],[3,"icon"],[1,"title"],[1,"subtitle"],["target","_blank","referrerpolicy","no-referrer",1,"read-origin",3,"href"],["echarts","",3,"options"],[1,"summaries"]],template:function(i,a){i&1&&E(0,Je,2,0,"div",1)(1,it,19,4,"mat-sidenav-container"),i&2&&(v(0,a.loading?0:-1),s(),v(1,a.list?1:-1))},dependencies:[xe,Se,we,_e,Me,Oe,ze,Le,Ie,De,Ee,Te,Re,Fe,Ue],styles:["[_nghost-%COMP%]{position:relative;display:block;height:100vh}.mat-sidenav-container[_ngcontent-%COMP%]{height:100%}.sidenav-toggle[_ngcontent-%COMP%]{position:absolute;right:10px;top:20px}.loading[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background-color:#fff;z-index:10}.title[_ngcontent-%COMP%]{text-align:center}.title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:24px 0 16px}.title[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin-right:100px;text-align:right}.title[_ngcontent-%COMP%]   .read-origin[_ngcontent-%COMP%]{font-size:12px;text-decoration:none}.title[_ngcontent-%COMP%]   .read-origin[_ngcontent-%COMP%]:active, .title[_ngcontent-%COMP%]   .read-origin[_ngcontent-%COMP%]:visited{color:#ccc}.title[_ngcontent-%COMP%]   .read-origin[_ngcontent-%COMP%]:hover{text-decoration:underline}[echarts][_ngcontent-%COMP%]{height:600px}.summaries[_ngcontent-%COMP%]{font-size:12px;line-height:1.33334;color:#333}.summaries[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:100px;list-style:none}"]});let n=e;return n})();var at=[{path:":range",component:U},{path:"",component:U}],Ze=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=y({type:e}),e.\u0275inj=f({imports:[k.forChild(at),k]});let n=e;return n})();var st=/^(\d{4})-(\d{1,2})$/,qe=(()=>{let e=class e{constructor(t){if(this.firestore=t,!P.firestore)throw new Error("can not connect to firestore");this.collection=ke(this.firestore,P.firestore.collectionName)}list(){return Ae(G(this.collection,Ge("createdAt","desc")))}getData(t){let{range:i}=t;if(!i)return D(()=>new Error("should specify a range to get"));let a=i.match(st);if(!a)return D(()=>new Error(`range invalid, should use 'yyyy-m', got ${i}`));let[,h,l]=a,x=G(this.collection,N("year","==",Number.parseInt(h)),N("month","==",Number.parseInt(l)));return H(Pe(x)).pipe(W(d=>{if(d.empty)return null;if(d.size>1)throw new Error(`specified range ${i} contains more than one record`);return u({id:d.docs[0].id},d.docs[0].data())}))}};e.\u0275fac=function(i){return new(i||e)(ie(je))},e.\u0275prov=ee({token:e,factory:e.\u0275fac});let n=e;return n})();var ri=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=y({type:e}),e.\u0275inj=f({providers:[{provide:b,useClass:qe}],imports:[Ne,Ze,$e.forRoot({echarts:()=>import("./chunk-W3XTDAPO.js")})]});let n=e;return n})();export{ri as DashboardModule};
