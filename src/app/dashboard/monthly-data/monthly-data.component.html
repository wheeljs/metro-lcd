@if (data) {
  <div class="md-monthly-data__container">
    <nz-card class="md-monthly-data__main-card">
      <div class="md-monthly-data__main">
        <md-statistic-item
          nzTitle="轨道交通线路"
          [value]="data.lines"
          nzSuffix="条"
        />
        <md-statistic-item
          nzTitle="运营里程"
          [value]="data.operationLength"
          nzSuffix="公里"
        />
        <md-statistic-item
          nzTitle="实际开行列车"
          [value]="data.runs"
          unit="万"
          nzSuffix="万次"
        />
        @if (data.newLines.count > 0) {
          <md-statistic-item
            nzTitle="新增运营线路"
            [value]="data.newLines.count"
            [nzSuffix]="newLineCountSuffix"
          />
          <ng-template #newLineCountSuffix>
            条
            <a class="md-monthly-data__popover-btn">
              <span
                nz-icon
                nzType="info-circle"
                nzTheme="outline"
                nz-popover
                nzPopoverOverlayClassName="md-monthly-data__news-popover"
                [nzPopoverContent]="newLinesDetail"
                nzPopoverPlacement="right"
              ></span>
            </a>
          </ng-template>
          <ng-template #newLinesDetail>
            @for (newLine of data.newLines.detail; track newLine.ch) {
              {{ newLine.ch }}@if (!$last) {<br />}
            }
          </ng-template>

          <md-statistic-item
            nzTitle="新增运营里程"
            [value]="data.newLines.operationLength"
            nzSuffix="公里"
          />
        } @else {
          <div class="md-monthly-data__new-lines__empty">本月无新开通线路</div>
        }
        @if (data.newSegments?.count! > 0) {
          <md-statistic-item
            nzTitle="新增运营区段"
            [value]="data.newSegments.count"
            [nzSuffix]="newSegmentCountSuffix"
          />
          <ng-template #newSegmentCountSuffix>
            个
            <a class="md-monthly-data__popover-btn">
              <span
                nz-icon
                nzType="info-circle"
                nzTheme="outline"
                nz-popover
                nzPopoverOverlayClassName="md-monthly-data__news-popover"
                [nzPopoverContent]="newSegmentsDetail"
                nzPopoverPlacement="right"
              ></span>
            </a>
          </ng-template>
          <ng-template #newSegmentsDetail>
            @for (newSegment of data.newSegments.detail; track newSegment.ch) {
              {{ newSegment.ch }}@if (!$last) {<br />}
            }
          </ng-template>
        }
      </div>
    </nz-card>

    <nz-card [nzActions]="[passengerCapacityQoQ, passengerCapacityYoY]">
      <md-statistic-item
        nzTitle="客运量"
        [value]="data.passengerCapacity.value"
        unit="亿"
      />
    </nz-card>
    <ng-template #passengerCapacityQoQ>
      <nz-flex nzAlign="center" nzJustify="space-around">
        <span>环比</span>
        <md-statistic-item
          [value]="data.passengerCapacity.compareLastMonth"
          unit="亿"
          autoPrefix
          autoColor
        />
        <md-statistic-item
          [value]="data.passengerCapacity.compareLastMonthPercent"
          percent
          autoPrefix
          autoColor
        />
      </nz-flex>
    </ng-template>
    <ng-template #passengerCapacityYoY>
      <nz-flex nzAlign="center" nzJustify="space-around">
        <span>同比</span>
        <md-statistic-item
          [value]="data.passengerCapacity.compareLastYear"
          unit="亿"
          autoPrefix
          autoColor
        />
        <md-statistic-item
          [value]="data.passengerCapacity.compareLastYearPercent"
          percent
          autoPrefix
          autoColor
        />
      </nz-flex>
    </ng-template>

    <nz-card [nzActions]="data.inStationCapacityVM ? [inStationCapacityQoQ] : []">
      <md-statistic-item
        nzTitle="进站量"
        [value]="data.inStationCapacity"
        unit="亿"
      />
    </nz-card>
    <ng-template #inStationCapacityQoQ>
      <nz-flex nzAlign="center" nzJustify="space-around">
        <span>环比</span>
        <md-statistic-item
          [value]="data.inStationCapacityVM.compareLastMonth!"
          unit="亿"
          autoPrefix
          autoColor
        />
        <md-statistic-item
          [value]="data.inStationCapacityVM.compareLastMonthPercent!"
          percent
          autoPrefix
          autoColor
        />
      </nz-flex>
    </ng-template>

    <nz-card [nzActions]="passengerStrongTpls">
      <md-statistic-item
        nzTitle="平均客运强度"
        [value]="data.passengerStrong.value"
        valueFormat="1.0-3"
        nzSuffix="万人次每公里日"
      />
    </nz-card>
    <ng-template #passengerStrongQoQ>
      <nz-flex nzAlign="center" nzJustify="space-around">
        @if (data.passengerStrongVM.compareLastMonthPercent) {
          <span>环比</span>
          @if (data.passengerStrongVM.compareLastMonth) {
            <md-statistic-item
              [value]="data.passengerStrongVM.compareLastMonth"
              valueFormat="1.0-3"
              autoPrefix
              autoColor
            />
          }
          <md-statistic-item
            [value]="data.passengerStrongVM.compareLastMonthPercent"
            percent
            autoPrefix
            autoColor
          />
        }
      </nz-flex>
    </ng-template>
    <ng-template #passengerStrongYoY>
      <nz-flex nzAlign="center" nzJustify="space-around">
        @if (data.passengerStrongVM.compareLastYearPercent) {
          <span>同比</span>
          <md-statistic-item
            [value]="data.passengerStrongVM.compareLastYearPercent"
            percent
            autoPrefix
            autoColor
          />
        }
      </nz-flex>
    </ng-template>

    <ng-template
      #volumeItem
      let-volumeName="volumeName"
      let-volume="volume"
      let-volumeCompare="volumeCompare"
      let-unit="unit"
    >
      <nz-card
        class="md-monthly-data__volume-card"
        [nzTitle]="volumeName"
        [nzBodyStyle]="{ padding: 0 }"
      >
        <div class="md-monthly-data__volume-card__container">
          <div class="md-monthly-data__volume-card__item">
            <md-statistic-item
              nzTitle="线路数"
              [value]="volume.lines"
              nzSuffix="条"
            />
            @if (volumeCompare?.lines?.compareLastMonth) {
              <md-statistic-item
                class="md-monthly-data__volume-card__item__compare"
                [value]="volumeCompare.lines.compareLastMonth"
                prefixMode="plusminus"
                autoPrefix
              />
            }
          </div>
          <div class="md-monthly-data__volume-card__item">
            <md-statistic-item
              nzTitle="运营里程"
              [value]="volume.operationLength"
              nzSuffix="公里"
            />
            @if (volumeCompare?.operationLength?.compareLastMonth) {
              <md-statistic-item
                class="md-monthly-data__volume-card__item__compare"
                [value]="volumeCompare.operationLength.compareLastMonth"
                prefixMode="plusminus"
                autoPrefix
              />
            }
          </div>
          <div class="md-monthly-data__volume-card__item">
            <md-statistic-item
              nzTitle="客运量"
              [value]="volume.passengerCapacity"
              [unit]="unit"
            />
            @if (volumeCompare?.passengerCapacity?.compareLastMonth) {
              <md-statistic-item
                class="md-monthly-data__volume-card__item__compare"
                [value]="volumeCompare.passengerCapacity.compareLastMonth"
                [unit]="unit"
                nzSuffix=""
                prefixMode="plusminus"
                autoPrefix
              />
            }
          </div>
          <div class="md-monthly-data__volume-card__item">
            <md-statistic-item
              nzTitle="进站量"
              [value]="volume.inStationCapacity"
              [unit]="unit"
            />
            @if (volumeCompare?.inStationCapacity?.compareLastMonth) {
              <md-statistic-item
                class="md-monthly-data__volume-card__item__compare"
                [value]="volumeCompare.inStationCapacity.compareLastMonth"
                [unit]="unit"
                nzSuffix=""
                prefixMode="plusminus"
                autoPrefix
              />
            }
          </div>
        </div>
      </nz-card>
    </ng-template>

    <div class="md-monthly-data__volumes">
      @if (data.largeVolume) {
        <ng-container *ngTemplateOutlet="volumeItem; context: {
          volumeName: '大运量',
          volume: data.largeVolume,
          volumeCompare: data.largeVolumeCompare,
          unit: '亿'
        }"/>
      }
      @if (data.mediumVolume) {
        <ng-container *ngTemplateOutlet="volumeItem; context: {
          volumeName: '中运量',
          volume: data.mediumVolume,
          volumeCompare: data.mediumVolumeCompare,
          unit: '万'
        }"/>
      }
      @if (data.smallVolume) {
        <ng-container *ngTemplateOutlet="volumeItem; context: {
          volumeName: '低运量',
          volume: data.smallVolume,
          volumeCompare: data.smallVolumeCompare,
          unit: '万'
        }"/>
      }
    </div>

  </div>
}
